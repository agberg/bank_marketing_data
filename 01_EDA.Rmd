---
title: "Bank Marketing Exploratory Analysis"
output: html_notebook
---

```{r, setup, message=FALSE}
library(tidyverse)
library(stringr)
```

## Download data

We are working with a dataset from a Portuguese bank.  The data categorizes direct marketing efforts (phone calls) designed to sell term deposit products.  The [dataset](https://archive.ics.uci.edu/ml/datasets/Bank+Marketing) was donated to UCI's Machine Learning Repository. The goal is to predict which clients are most likely to subscribe to a term deposit. Data range from May 2008 to November 2010


```{r}
download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/00222/bank-additional.zip",
              destfile = "data/bank-additional.zip")

unzip(zipfile = "data/bank-additional.zip", 
      exdir = "data", 
      files = "bank-additional/bank-additional-full.csv", 
      junkpaths = TRUE)
```

## Read data

```{r}
# Read data
raw_data <- read_delim(file = "data/bank-additional-full.csv", 
                       delim = ";", 
                       col_types = cols(nr.employed = col_number())) 

# Format column names
names(raw_data) <- str_replace_all(names(raw_data), "[.]", "_")

# Rename and remove columns
all_data <- raw_data %>%
    rename(term_deposit = y,
           prior_outcome = poutcome,
           personal_loan = loan,
           housing_loan = housing,
           in_default = default) %>%
  mutate(job = str_replace_all(job, "[.-]", "")) %>%
  mutate(total_contacts = campaign + previous) %>%
  select(-c(nr_employed, emp_var_rate, previous, pdays, campaign, duration)) %>%
  na.omit

# Impute Year
all_data <- all_data %>%
  mutate(year = ifelse(month != lag(month, default = "may"), 1, 0)) %>%
  mutate(year = cumsum(year)) %>%
  mutate(year = findInterval(year, c(7, 17))) %>%
  mutate(year = case_when(year == 0 ~ 2008,
                          year == 1 ~ 2009,
                          year == 2 ~ 2010))
```

## Insights

Clients with a successful prior outcome were much more likley to subscribe to a term deposit.

```{r}
all_data %>%
  group_by(term_deposit) %>%
  count(prior_outcome) %>%
  mutate(pct = round(100 * n / sum(n), 1)) %>%
  select(-n) %>%
  spread(term_deposit, pct)
```

```
euribor3m                  100.000
cons_conf_idx               47.944
cons_price_idx              41.269
prior_outcomesuccess        36.260
contactcellular             28.833
age                         26.938
monthoct                     8.887
jobstudent                   7.352
monthapr                     7.055
monthmar                     6.284
monthsep                     5.928
jobbluecollar                5.395
monthjun                     4.451
jobretired                   4.349
maritalsingle                4.078
monthjul                     3.604
educationuniversity.degree   3.545
educationbasic.9y            3.528
prior_outcomefailure         3.510
monthaug                     3.049
```

```
Coefficients: (1 not defined because of singularities)
                               Estimate Std. Error z value Pr(>|z|)    
(Intercept)                  44.1916549  5.4304260   8.138 4.03e-16 ***
age                           0.0003518  0.0029777   0.118 0.905943    
jobservices                  -0.1653804  0.2132079  -0.776 0.437940    
jobadmin                     -0.3679924  0.1992202  -1.847 0.064723 .  
jobbluecollar                -0.2292608  0.2005235  -1.143 0.252909    
jobtechnician                -0.3301286  0.2047834  -1.612 0.106943    
jobretired                   -0.6175871  0.2160162  -2.859 0.004250 ** 
jobmanagement                -0.2973495  0.2150323  -1.383 0.166722    
jobunemployed                -0.2329516  0.2427756  -0.960 0.337290    
jobselfemployed              -0.2684730  0.2357350  -1.139 0.254755    
jobunknown                   -0.0603026  0.3448255  -0.175 0.861175    
jobentrepreneur              -0.4561399  0.2358319  -1.934 0.053092 .  
jobstudent                   -0.7516971  0.2334402  -3.220 0.001282 ** 
maritalsingle                -0.0594961  0.0632755  -0.940 0.347078    
maritaldivorced               0.0986579  0.0866308   1.139 0.254773    
maritalunknown                0.0420853  0.6533356   0.064 0.948639    
educationhigh.school         -0.0071869  0.0987598  -0.073 0.941988    
educationbasic.9y             0.0926341  0.1019709   0.908 0.363648    
educationprofessional.course  0.0036606  0.1123840   0.033 0.974015    
educationunknown             -0.1383519  0.1375653  -1.006 0.314551    
educationuniversity.degree   -0.0022740  0.0999032  -0.023 0.981840    
housing_loanyes               0.0150907  0.0508945   0.297 0.766840    
housing_loanunknown          -0.2040016  0.1568715  -1.300 0.193451    
personal_loanyes             -0.0002378  0.0700147  -0.003 0.997291    
personal_loanunknown                 NA         NA      NA       NA    
contactcellular              -0.5051436  0.0860003  -5.874 4.26e-09 ***
monthjun                     -0.7099218  0.0961936  -7.380 1.58e-13 ***
monthjul                     -0.8811173  0.0997447  -8.834  < 2e-16 ***
monthaug                     -0.6169071  0.1083088  -5.696 1.23e-08 ***
monthoct                     -0.8444931  0.1454406  -5.806 6.38e-09 ***
monthnov                     -0.6415858  0.1047814  -6.123 9.18e-10 ***
monthdec                     -1.2760025  0.2551386  -5.001 5.70e-07 ***
monthmar                     -1.4812625  0.1510757  -9.805  < 2e-16 ***
monthapr                     -0.6466849  0.0916309  -7.057 1.70e-12 ***
monthsep                     -0.5152310  0.1622927  -3.175 0.001500 ** 
day_of_weektue               -0.2637108  0.0812926  -3.244 0.001179 ** 
day_of_weekwed               -0.4258869  0.0805499  -5.287 1.24e-07 ***
day_of_weekthu               -0.3150764  0.0788506  -3.996 6.45e-05 ***
day_of_weekfri               -0.2767598  0.0816305  -3.390 0.000698 ***
prior_outcomefailure          0.4989603  0.0783148   6.371 1.88e-10 ***
prior_outcomesuccess         -1.3150585  0.0971121 -13.542  < 2e-16 ***
cons_price_idx               -0.4746509  0.0592834  -8.006 1.18e-15 ***
cons_conf_idx                -0.0494014  0.0065456  -7.547 4.44e-14 ***
euribor3m                     0.5722562  0.0218645  26.173  < 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
```

```{r}
all_data
```

